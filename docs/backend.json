{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "bio": {
          "type": "string",
          "description": "The biography of the user."
        },
        "profilePhoto": {
          "type": "string",
          "description": "URL of the user's profile photo."
        },
        "followers": {
          "type": "array",
          "description": "References to Users who are following this user. (Relationship: User N:N User)",
          "items": {
            "type": "string"
          }
        },
        "following": {
          "type": "array",
          "description": "References to Users who this user is following. (Relationship: User N:N User)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "verified": {
          "type": "boolean",
          "description": "Indicates whether the user's account is verified."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "createdAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who created this post. (Relationship: User 1:N Post)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image in the post."
        },
        "caption": {
          "type": "string",
          "description": "The caption of the post."
        },
        "location": {
          "type": "string",
          "description": "The location where the post was taken."
        },
        "likes": {
          "type": "array",
          "description": "References to Users who liked this post. (Relationship: User N:N Post)",
          "items": {
            "type": "string"
          }
        },
        "commentsCount": {
          "type": "number",
          "description": "The number of comments on the post."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "imageUrl",
        "createdAt"
      ]
    },
    "Story": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Story",
      "type": "object",
      "description": "Represents a story in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the story entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who created this story. (Relationship: User 1:N Story)"
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media in the story."
        },
        "type": {
          "type": "string",
          "description": "The type of the media (image/video)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the story was created.",
          "format": "date-time"
        },
        "expiresAt": {
          "type": "string",
          "description": "Timestamp indicating when the story expires.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "mediaUrl",
        "type",
        "createdAt",
        "expiresAt"
      ]
    },
    "Reel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reel",
      "type": "object",
      "description": "Represents a reel in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reel entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who created this reel. (Relationship: User 1:N Reel)"
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the video in the reel."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the thumbnail for the reel."
        },
        "likes": {
          "type": "array",
          "description": "References to Users who liked this reel. (Relationship: User N:N Reel)",
          "items": {
            "type": "string"
          }
        },
        "commentsCount": {
          "type": "number",
          "description": "The number of comments on the reel."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the reel was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "videoUrl",
        "thumbnailUrl",
        "createdAt"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post or reel in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment entity."
        },
        "parentId": {
          "type": "string",
          "description": "Reference to either a Post or Reel that this comment belongs to."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who created this comment. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "parentId",
        "userId",
        "text",
        "createdAt"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat between two users in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat entity."
        },
        "users": {
          "type": "array",
          "description": "References to the Users participating in this chat. (Relationship: User N:N Chat)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "users"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message within a chat in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message entity."
        },
        "chatId": {
          "type": "string",
          "description": "Reference to Chat this message belongs to. (Relationship: Chat 1:N Message)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User who sent this message. (Relationship: User 1:N Message)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the message. If mediaUrl is present, this should be null."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media in the message. If text is present, this should be null."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates whether the message has been read."
        }
      },
      "required": [
        "id",
        "chatId",
        "senderId",
        "timestamp"
      ]
    },
    "Call": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Call",
      "type": "object",
      "description": "Represents a call between two users in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the call entity."
        },
        "callerId": {
          "type": "string",
          "description": "Reference to User who initiated the call. (Relationship: User 1:N Call)"
        },
        "receiverId": {
          "type": "string",
          "description": "Reference to User who received the call. (Relationship: User 1:N Call)"
        },
        "offer": {
          "type": "string",
          "description": "The SDP offer for the call."
        },
        "answer": {
          "type": "string",
          "description": "The SDP answer for the call."
        },
        "candidates": {
          "type": "array",
          "description": "Array of ICE candidates for the call.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "callerId",
        "receiverId",
        "offer",
        "answer",
        "candidates"
      ]
    },
    "LiveStream": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LiveStream",
      "type": "object",
      "description": "Represents a live stream in the YC application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the live stream entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who is hosting the live stream. (Relationship: User 1:N LiveStream)"
        },
        "title": {
          "type": "string",
          "description": "The title of the live stream."
        },
        "description": {
          "type": "string",
          "description": "A description of the live stream."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the live stream started.",
          "format": "date-time"
        },
        "viewerIds": {
          "type": "array",
          "description": "References to Users currently watching the live stream. (Relationship: User N:N LiveStream)",
          "items": {
            "type": "string"
          }
        },
        "likeIds": {
          "type": "array",
          "description": "References to Users who liked this live stream. (Relationship: User N:N LiveStream)",
          "items": {
            "type": "string"
          }
        },
        "chatId": {
          "type": "string",
          "description": "Reference to the Chat associated with the live stream. (Relationship: Chat 1:1 LiveStream)"
        },
        "streamUrl": {
          "type": "string",
          "description": "URL for the live stream video."
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "startTime",
        "streamUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Authorization: Users can only modify their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores posts created by users. Authorization:  Posts are owned by the user specified in userId.  Includes denormalized `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who created the post."
            },
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stories/{storyId}",
        "definition": {
          "entityName": "Story",
          "schema": {
            "$ref": "#/backend/entities/Story"
          },
          "description": "Stores stories created by users. Authorization: Stories are owned by the user specified in userId.  Includes denormalized `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who created the story."
            },
            {
              "name": "storyId",
              "description": "The unique identifier for the story."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reels/{reelId}",
        "definition": {
          "entityName": "Reel",
          "schema": {
            "$ref": "#/backend/entities/Reel"
          },
          "description": "Stores reels created by users. Authorization: Reels are owned by the user specified in userId. Includes denormalized `userId` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who created the reel."
            },
            {
              "name": "reelId",
              "description": "The unique identifier for the reel."
            }
          ]
        }
      },
      {
        "path": "/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments on posts and reels.  Authorization:  Any authenticated user can create a comment. Deletion may be restricted to the comment owner or authorized moderators.",
          "params": [
            {
              "name": "commentId",
              "description": "The unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores chat metadata.  Authorization: Only users included in the 'users' array can access chat details.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier for the chat."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages within a chat. Authorization: Only users included in the parent chat's 'users' array can access messages.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier for the chat."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the message."
            }
          ]
        }
      },
      {
        "path": "/calls/{callId}",
        "definition": {
          "entityName": "Call",
          "schema": {
            "$ref": "#/backend/entities/Call"
          },
          "description": "Stores call information. Authorization: Access restricted to caller and receiver.",
          "params": [
            {
              "name": "callId",
              "description": "The unique identifier for the call."
            }
          ]
        }
      },
      {
        "path": "/liveStreams/{liveStreamId}",
        "definition": {
          "entityName": "LiveStream",
          "schema": {
            "$ref": "#/backend/entities/LiveStream"
          },
          "description": "Stores live stream information. Authorization: Access control based on userId for the host and viewerIds for viewers. The userId, likeIds, and viewerIds are denormalized into the document for authorization independence.",
          "params": [
            {
              "name": "liveStreamId",
              "description": "The unique identifier for the live stream."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to mirror the social media application's features, focusing on user-generated content and interactions. It is built on the principle of path-based ownership and denormalization to ensure security and efficient data retrieval. All collections adhere to Structural Segregation.\n\nAuthorization Independence is achieved by avoiding `get()` calls in security rules. User-specific data (posts, stories, reels) are nested under `/users/{userId}`, which allows simple rules based on `request.auth.uid == userId`. For collaborative data like chats, the `users` array containing user IDs serves as a membership map, enabling authorization based on user presence in the array.  For `LiveStream`, the `userId` field will be duplicated to the document itself, and the `likeIds` and `viewerIds` are also duplicated in the `LiveStream` document. This duplication facilitates authorization checks directly on the `LiveStream` document without requiring a get() operation.\n\nThe structure supports secure `list` operations (QAPs) through segregation. For example, posts are always accessed via `/users/{userId}/posts/{postId}`, ensuring that only the owner can list their posts or any authenticated user can view another user's public posts, depending on your security rules.  Similarly, chats are accessed via `/chats/{chatId}` where security rules ensure only members can access the contents, preventing unauthorized listing."
  }
}